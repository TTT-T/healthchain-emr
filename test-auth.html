<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Test</title>
</head>
<body>
    <h1>Authentication Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message) {
            results.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        // Check token storage
        function checkTokenStorage() {
            log('=== Token Storage Check ===');
            
            // Check localStorage
            const localToken = localStorage.getItem('access_token');
            log('localStorage token: ' + (localToken ? 'EXISTS' : 'NOT FOUND'));
            if (localToken) {
                log('Token preview: ' + localToken.substring(0, 50) + '...');
            }
            
            // Check sessionStorage
            const sessionToken = sessionStorage.getItem('access_token');
            log('sessionStorage token: ' + (sessionToken ? 'EXISTS' : 'NOT FOUND'));
            if (sessionToken) {
                log('Token preview: ' + sessionToken.substring(0, 50) + '...');
            }
            
            // Check cookies
            const cookies = document.cookie;
            log('Cookies: ' + (cookies ? cookies : 'NO COOKIES'));
            
            // Check rememberMe preference
            const rememberMe = localStorage.getItem('rememberMe');
            log('Remember Me: ' + (rememberMe || 'NOT SET'));
        }
        
        // Test API call
        async function testAPICall() {
            log('=== API Call Test ===');
            
            const token = localStorage.getItem('access_token') || sessionStorage.getItem('access_token');
            
            if (!token) {
                log('ERROR: No token found for API call');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    }
                });
                
                log('API Response Status: ' + response.status);
                log('API Response Headers: ' + JSON.stringify(Object.fromEntries(response.headers.entries())));
                
                const data = await response.json();
                log('API Response Data: ' + JSON.stringify(data, null, 2));
                
            } catch (error) {
                log('API Call Error: ' + error.message);
            }
        }
        
        // Run tests
        checkTokenStorage();
        testAPICall();
    </script>
</body>
</html>
